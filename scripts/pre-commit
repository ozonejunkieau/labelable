#!/bin/sh
# Pre-commit hook for Labelable
# Install with: ln -sf ../../scripts/pre-commit .git/hooks/pre-commit

set -e

echo "Checking version consistency..."
PY_VERSION=$(grep -o '__version__ = "[^"]*"' src/labelable/__init__.py | cut -d'"' -f2)
HA_VERSION=$(grep -o 'version: "[^"]*"' labelable/config.yaml | cut -d'"' -f2)

if [ "$PY_VERSION" != "$HA_VERSION" ]; then
    echo "ERROR: Version mismatch!"
    echo "  src/labelable/__init__.py: $PY_VERSION"
    echo "  labelable/config.yaml:     $HA_VERSION"
    echo "Please ensure both versions match before committing."
    exit 1
fi
echo "Versions match: $PY_VERSION"

echo "Running ruff check..."
uv run ruff check src tests

echo "Running tests..."
uv run pytest -q

echo "Pre-commit checks passed!"
